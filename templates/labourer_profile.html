<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Labourer Profile</title>
    <style>
      body {
        background-color: #ffffff;
        margin: 0;
        padding: 0;
        margin-bottom: 70px;
      }

      /* Profile container */
      .profile-container {
        max-width: 600px;
        margin: 20px auto;
        background-color: #ffffff;
        border-radius: 15px;
        padding: 20px;
      }

      /* Section container */
      .section-container {
        margin-bottom: 20px;
        padding: 20px;
        background-color: #f9f9f9;
        border: 1px solid #ddd;
        border-radius: 10px;
      }

      .section-container:last-child {
        margin-bottom: 50px;
      }

      /* Section headings */
      .section-container h2 {
        margin-top: 0;
        font-size: 20px;
        color: #333;
        border-bottom: 2px solid #ff7148;
        padding-bottom: 5px;
        margin-bottom: 15px;
      }

      /* Info items */
      .info-item {
        display: flex;
        justify-content: space-between;
        padding: 10px;
        background-color: #ffffff;
        border: 1px solid #ddd;
        border-radius: 5px;
        margin-bottom: 10px;
        font-size: 14px;
        overflow: hidden; /* Hides overflowed content */
        white-space: nowrap; /* Prevents text from wrapping */
        text-overflow: ellipsis; /* Adds ellipsis when text overflows */
      }

      .info-item strong {
        color: #333;
        font-weight: bold;
        margin-right: 20px;
      }

      .info-item span {
        color: #555;
        overflow: hidden; /* Hides overflowed content */
        white-space: nowrap; /* Prevents text from wrapping */
        text-overflow: ellipsis; /* Adds ellipsis when text overflows */
      }

      /* Edit button */
      .edit-button {
        text-align: center;
        margin-bottom: 10px;
        margin-top: 25px;
      }

      .edit-button a {
        color: #ffffff;
        background-color: #333;
        border-radius: 5px;
        padding: 10px 20px;
        text-decoration: none;
        font-size: 14px;
        margin-top: 10px;
      }

      /* User location */
      .user-location {
        text-align: center;
        font-size: 18px;
        color: #3f3f3fc6;
      }

      .user-location .fa-map-marker-alt {
        font-size: 18px;
        vertical-align: middle;
        color: #3f3f3f82;
      }

      /* Profile image */
      .profile-pic-container {
        text-align: center;
        position: relative;
        margin-bottom: 40px;
      }

      .profile-pic {
        height: 155px;
        width: 155px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid #3f3f3f82;
      }

      .profile-pic-overlay {
        position: absolute;
        bottom: -10px;
        left: 50%;
        transform: translateX(-50%);
        padding: 5px;
        border-radius: 10px;
      }

      .edit-pic-button {
        background-color: #333;
        color: white;
        border: none;
        padding: 10px 20px;
        cursor: pointer;
        border-radius: 25px;
      }

      .social-links-info {
        background-color: #ffffff;
        padding: 15px;
        border-radius: 4px;
        margin-top: -15px;
        font-size: 14px;
        color: #333;
        line-height: 1.6;
      }

      .company-details-info {
        background-color: #ffffff;
        padding: 15px;
        border-radius: 4px;
        margin-top: -15px;
        font-size: 14px;
        color: #333;
        line-height: 1.6;
      }

      /* Job categories and locations section */
      .categories-locations-container {
        background-color: #f9f9f9;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: -10px;
        border: 1px solid #ddd;
      }

      .categories-locations-container h3 {
        font-size: 20px;
        color: #333;
        border-bottom: 2px solid #ff7148;
        padding-bottom: 5px;
      }

      .categories-locations-list {
        list-style: none;
        padding-left: 0;
        margin-top: 10px;
      }

      .categories-locations-list li {
        background-color: #ffffff;
        padding: 10px;
        margin: 5px 0;
        border-radius: 5px;
        font-size: 14px;
        border: 1px solid #ddd;
      }

      /* Image preview styling */
      #image-preview {
        margin-top: 10px;
        width: 150px;
        height: auto; /* Maintain aspect ratio */
        border-radius: 10px;
        display: block; /* Ensure it's a block element */
        align-items: center;
      }

      /* Styling for both buttons */
      .upload-id-button {
        background-color: #333; /* Dark gray background */
        color: white; /* White text */
        border: none; /* Remove default border */
        padding: 10px 20px; /* Add padding for click area */
        cursor: pointer; /* Pointer cursor for hover */
        border-radius: 5px; /* Rounded corners */
        margin-top: 10px; /* Space between elements */
        text-align: center; /* Center text */
        display: inline-block; /* Ensure inline-block layout */
      }

      /* Add hover effect for the button */
      .upload-id-button:hover {
        background-color: #555; /* Slightly lighter gray */
      }

      /* Additional container adjustments (optional) */
      #image-preview-container {
        text-align: center; /* Center content inside the container */
        margin-top: 20px;
        align-items: center;
      }

      #insurance-image-preview-container {
        text-align: center; /* Center content inside the container */
        margin-top: 20px;
        align-items: center;
      }

      #insurance-image-preview {
        margin-top: 10px;
        width: 150px;
        height: auto; /* Maintain aspect ratio */
        border-radius: 10px;
        display: block; /* Ensure it's a block element */
        align-items: center;
      }

      .modal {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        justify-content: center;
        align-items: center;
      }

      .modal-content {
        background-color: #fff;
        padding: 20px;
        border-radius: 25px;
        width: 400px;
        text-align: center;
        width: 80%;
      }

      .modal-header {
        font-size: 1.2em;
        margin-bottom: 20px;
      }

      .modal-footer button {
        padding: 10px 20px;
        margin: 5px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }

      .modal-footer .cancel-btn {
        background-color: #ccc;
      }

      .modal-footer .delete-btn {
        background-color: #ff4141;
        color: #fff;
      }

      #deleteAccountBtn {
        margin-top: 30px;
        color: #ffffff; /* Button text color */
        background-color: #f44336; /* Red background for danger */
        border: none; /* Remove border */
        padding: 8px 10px;
        border-radius: 4px; /* Rounded corners */
        cursor: pointer; /* Pointer cursor on hover */
        font-size: 16px; /* Text size */
      }

      /* Style for the arrow */
      .arrow {
        margin-left: 8px; /* Space between text and arrow */
        font-size: 18px; /* Arrow size */
      }

      .modal-header {
        font-size: 1.2em;
        margin-bottom: 20px;
      }

      .modal-footer button {
        padding: 10px 20px;
        margin: 5px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }

      input,
      select {
        width: 100%;
        height: 150%;
        padding: 10px;
        margin-bottom: 16px;
        box-sizing: border-box;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 16px;
      }
      .modal-footer .cancel-btn {
        background-color: #ccc;
      }

      .modal-footer .delete-btn {
        background-color: #ff7148;
        color: #fff;
      }

      button {
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
        padding: 15px;
        background-color: #ffffff;
        border: 1px solid #555;
        border-radius: 8px;
        cursor: pointer;
        font-size: 18px;
        color: #333;
        text-align: left;
        transition: background-color 0.3s ease, border-color 0.3s ease;
      }

      button .arrow {
        font-weight: bold;
        font-size: 24px;
        margin-left: auto;
      }

      button.btn-danger {
        background-color: #ffffff;
        border-color: #ff7148;
        color: #ff7148;
      }

      .h2 {
        font-size: 30px;
      }

      /* Styles specific to the location modal */

      #locationModal .btn-primary {
        background-color: #ff7148;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }

      #locationModal .btn-close {
        background-color: #ccc;
      }

      /* Remove button styles */
      .lower {
        font-size: 16px; /* Adjust the font size */
        color: #333; /* Blue color for text */
        text-decoration: none; /* Remove underline */
        cursor: pointer; /* Pointer cursor */
        display: inline-flex;
        align-items: center; /* Align arrow next to text */
      }

      .lower:hover {
        color: #9b9b9b; /* Darker blue on hover */
      }

      .arrow {
        margin-left: 8px; /* Space between the text and the arrow */
        font-size: 20px; /* Arrow size */
      }

      #deleteAccountBtn {
        background-color: transparent; /* Make the button transparent */
        border: none; /* Remove the border */
        padding: 0; /* Remove padding */
        color: #ff4141; /* Red color for text */
        cursor: pointer; /* Pointer cursor */
      }

      .lower-buttons {
        padding: 20px;
      }

      .verification-container {
        margin-top: 30px;
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 8px;
        background-color: #f9f9f9;
        text-align: center;
      }

      .verification-container h3 {
        margin-bottom: 15px;
      }

      .verification-container p {
        margin-bottom: 10px;
        color: #555;
      }

      .verification-container label {
        display: block;
        margin-bottom: 15px;
        font-size: 14px;
        color: #333;
      }

      .verification-container .complete-btn {
        padding: 10px 20px;
        border: none;
        background-color: #28a745;
        color: #fff;
        font-size: 16px;
        border-radius: 5px;
        cursor: pointer;
      }

      .verification-container .complete-btn:hover {
        background-color: #218838;
      }
    </style>
  </head>
  <body>
    {% extends 'base_labour.html' %} {% block title %}Labourer{% endblock %} {%
    block content %}
    <div class="profile-container">
      <!-- Profile Picture -->
      <div class="profile-pic-container">
        <img
          src="{{ url_for('static', filename='profile_pics/' + (current_user.profile_image.filename if current_user.profile_image else 'orange.jpg')) }}"
          alt="Profile Image"
          class="profile-pic"
        />
        <div class="profile-pic-overlay">
          <form
            id="profile-image-form"
            action="{{ url_for('labourer_image') }}"
            method="POST"
            enctype="multipart/form-data"
          >
            <label for="profile-image-upload" class="edit-pic-button"
              >Choose Image</label
            >
            <input
              type="file"
              id="profile-image-upload"
              name="profile_image"
              style="display: none"
              onchange="document.getElementById('profile-image-form').submit();"
            />
          </form>
        </div>
      </div>

      <!-- User Location -->
      <div class="user-location">
        <p><i class="fas fa-map-marker-alt"></i> {{ current_user.location }}</p>
      </div>
      <div class="social-links-info">
        <p>
          Step 1: Please complete your basic information before moving onto the
          next sections of profile setup. Be sure to choose a picture of
          yourself or company logo to display on your profile.
        </p>
      </div>

      <!-- User Information -->
      <div class="section-container">
        <h2>Basic Information*</h2>
        <div class="info-item">
          <strong>First Name:</strong>
          <span>{{ current_user.labourer_profile.first_name }}</span>
        </div>
        <div class="info-item">
          <strong>Last Name:</strong>
          <span>{{ current_user.labourer_profile.last_name }}</span>
        </div>
        <div class="info-item">
          {% if current_user.labourer_profile.date_of_birth %}
          <strong>Date of Birth:</strong>
          <span
            >{{ current_user.labourer_profile.date_of_birth.strftime('%d-%m-%Y')
            }}</span
          >
          {% else %}
          <strong>Date of Birth:</strong>
          <span></span>
          {% endif %}
        </div>
        <div class="info-item">
          <strong>Phone Number:</strong>
          <span>{{ current_user.labourer_profile.phone_number }}</span>
        </div>
        <div class="info-item">
          <strong>About Us:</strong>
          <span>{{ current_user.labourer_profile.user_blurb }}</span>
        </div>
        <div class="edit-button">
          <a href="{{ url_for('edit_labourer_profile') }}">Update Basic Information</a>
        </div>
      </div>

      <div class="social-links-info">
        <p>
          Step 2: Select the Locations you operate in and the Job Categories you
          are interested in being shown.
        </p>
      </div>

      <!-- Categories and Locations Section -->
      <div class="categories-locations-container">
        <h3>Job Categories & Locations*</h3>
        <div>
          <strong>Selected Categories:</strong>
          <ul class="categories-locations-list">
            {% if current_user.labourer_profile.job_categories %} {% for
            category in current_user.labourer_profile.job_categories.split(', ')
            %}
            <li>{{ category }}</li>
            {% endfor %} {% else %}
            <li>Please select job categories.</li>
            {% endif %}
          </ul>
        </div>
        <div>
          <strong>Selected Locations:</strong>
          <ul class="categories-locations-list">
            {% if current_user.labourer_profile.job_locations %} {% for location
            in current_user.labourer_profile.job_locations.split(', ') %}
            <li>{{ location }}</li>
            {% endfor %} {% else %}
            <li>Please select job locations.</li>
            {% endif %}
          </ul>
          <div class="edit-button">
            <a href="{{ url_for('select_job_categories_and_locations') }}"
              >Update Categories & Locations</a
            >
          </div>
        </div>
      </div>
      <div class="company-details-info">
        <p>
          Step 3: Please complete your Business details. Only your trading name,
          NZBN and established date will be publicly visible on your profile.
        </p>
      </div>

      <!-- Company Information -->
      <div class="section-container">
        <h2>Company Details*</h2>
        <div class="info-item">
          <strong>Business Type:</strong>
          <span>{{ current_user.company_details.business_type }}</span>
        </div>
        <div class="info-item">
          <strong>Trading Name:</strong>
          <span>{{ current_user.company_details.trading_name }}</span>
        </div>
        <div class="info-item">
          <strong>Established:</strong>
          <span>{{ current_user.company_details.established }}</span>
        </div>
        <div class="info-item">
          <strong>NZBN:</strong>
          <span>{{ current_user.company_details.nzbn }}</span>
        </div>
        <div class="info-item">
          <strong>Director First Name:</strong>
          <span>{{ current_user.company_details.director_first_name }}</span>
        </div>
        <div class="info-item">
          <strong>Director Last Name:</strong>
          <span>{{ current_user.company_details.director_last_name }}</span>
        </div>
        <div class="info-item">
          <strong>Physical Address:</strong>
          <span>{{ current_user.company_details.physical_address }}</span>
        </div>
        <div class="info-item">
          <strong>Unit/Flat No:</strong>
          <span>{{ current_user.company_details.unit_no }}</span>
        </div>

        <div class="edit-button">
          <a href="{{ url_for('edit_tradesman_profile') }}">Update Business Details</a>
        </div>
      </div>
      <div class="social-links-info">
        <p>
          Step 4: We recommend including links to your business's social pages
          or other relevant online profiles to give users a better idea of who
          you are and build trust.
        </p>
      </div>

      <!-- Social Links -->
      <div class="section-container">
        <h2>Social Links</h2>
        <div class="info-item">
          <strong>Facebook:</strong>
          <span>{{ current_user.social_links.facebook }}</span>
        </div>
        <div class="info-item">
          <strong>Instagram:</strong>
          <span>{{ current_user.social_links.instagram }}</span>
        </div>
        <div class="info-item">
          <strong>Website:</strong>
          <span>{{ current_user.social_links.website }}</span>
        </div>
        <div class="info-item">
          <strong>Google:</strong>
          <span>{{ current_user.social_links.google }}</span>
        </div>

        <div class="edit-button">
          <a href="{{ url_for('edit_social_links') }}">Update Social Links</a>
        </div>
      </div>
      <div class="social-links-info">
        <p>
          Step 5: We require one form of identification to compare against your
          business details. This can be a picture of the front of your Drivers
          Licence or Passport photo page.
        </p>
      </div>

      <!-- Image Upload Section -->
      <div class="section-container">
        <h2>Upload Your ID Image*</h2>
        {% if user.labourer_profile.id_image %}
        <p>Your ID is saved</p>
        {% else %} {% endif %}
        <form
          id="id-image-form"
          action="{{ url_for('upload_id_image') }}"
          method="POST"
          enctype="multipart/form-data"
          class="upload-id-form"
        >
          <label for="id-image-upload" class="upload-id-button"
            >Upload ID Image</label
          >
          <input
            type="file"
            id="id-image-upload"
            name="id_image"
            style="display: none"
            accept="image/*"
            onchange="previewImage()"
          />
        </form>

        <!-- Preview Section -->
        <div id="image-preview-container" style="display: none">
          <img id="image-preview" src="" alt="Image Preview" />
          <button
            type="button"
            class="upload-id-button"
            onclick="submitIdImage()"
          >
            Confirm Image
          </button>
        </div>

        <!-- Upload Status -->
        <div id="upload-status"></div>
      </div>

      <div class="social-links-info">
        <p>
          Step 6: Upload a photo or file of your Business Liability Insurance
          document(s), ensuring that all key details are visible. This includes
          the policyholder's name, insurance provider, policy number, coverage
          details, and expiration date.
        </p>
      </div>
      <!-- Insurance Image Upload Section -->
      <div class="section-container">
        <h2>Upload Your Business Liability Insurance*</h2>
        {% if user.labourer_profile.insurance_image %}
        <p>Your Insurance document(s) are saved</p>
        {% else %} {% endif %}
        <form
          id="insurance-image-form"
          action="{{ url_for('upload_liability_insurance') }}"
          method="POST"
          enctype="multipart/form-data"
          class="upload-insurance-form"
        >
          <label for="insurance-image-upload" class="upload-id-button">
            Upload Insurance Document(s)
          </label>
          <input
            type="file"
            id="insurance-image-upload"
            name="liability_insurance"
            style="display: none"
            accept="image/*,.pdf"
            onchange="previewInsuranceImage()"
            multiple
          />
        </form>
        <!-- Preview Section -->
        <div id="insurance-image-preview-container" style="display: none">
          <div id="preview-images"></div>
          <button
            type="button"
            class="upload-id-button"
            onclick="submitInsuranceImage()"
          >
            Confirm Images/Documents
          </button>
        </div>

        <!-- Upload Status -->
        <div id="insurance-upload-status"></div>
      </div>

      <div class="verification-container">
        {% if current_user.labourer_profile.verification_ready == False %}
        <h3>Profile Completion</h3>
        <p>
          Please confirm that all your information is correct and up-to-date
          before marking your profile as complete.
        </p>
        <form method="POST" action="{{ url_for('verify_profile') }}">
          <label>
            <input type="checkbox" name="confirmation" required />
            I confirm that all my information is correct.
          </label>
          <button type="submit" class="complete-btn">
            Mark Profile as Complete
          </button>
        </form>
        {% elif current_user.labourer_profile.verification_ready == True and current_user.labourer_profile.id_verified == False %}
        <h3>Profile Under Review</h3>
        <p>
          Your profile is awaiting validation from our team. This can take up to 24 hours, you will be
          notified once it is verified.
        </p>
        </div>
        {% elif current_user.labourer_profile.id_verified == True %}
          <h3>Profile Verified</h3>
             <p>
              Your profile has been successfully verified. You can now access all features.
            </p>
        {% endif %}
      </div>

      <!-- Delete account section -->

      <div class="lower-buttons">
        <a href="#" id="changeEmailBtn" class="lower">
          <span>Change Email</span>
          <span class="arrow">→</span>
        </a>
        <br />

        <a href="#" id="changePasswordBtn" class="lower">
          <span>Change Password</span>
          <span class="arrow">→</span>
        </a>
        <br />

        <a href="#" id="changeLocationBtn" class="lower">
          <span>Change Location</span>
          <span class="arrow">→</span>
        </a>
        <br />

        <button type="button" id="deleteAccountBtn" class="btn btn-danger">
          Delete Account
        </button>
      </div>

      <!-- Modal for account deletion confirmation -->
      <div id="deleteAccountModal" class="modal" style="display: none">
        <div class="modal-content">
          <div class="modal-header">
            <h4>Confirm Account Deletion</h4>
          </div>
          <p>
            Are you sure you want to delete your account? This action is
            irreversible.
          </p>
          <div class="modal-footer">
            <button type="button" class="cancel-btn" id="cancelDelete">
              Cancel
            </button>
            <form method="POST" action="{{ url_for('delete_account') }}">
              <button type="submit" class="delete-btn">Delete Account</button>
            </form>
          </div>
        </div>
      </div>

      <!-- Modal for Change Email -->
      <div id="changeEmailModal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h4>Change Email</h4>
          </div>
          <form method="POST" action="{{ url_for('labourer_change_email') }}">
            <input
              type="email"
              name="new_email"
              placeholder="Enter New Email"
              required
            />
            <input
              type="password"
              name="password"
              placeholder="Enter Current Password"
              required
            />
            <div class="modal-footer">
              <button type="button" class="cancel-btn" id="cancelChangeEmail">
                Cancel
              </button>
              <button type="submit" class="delete-btn">Submit</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Modal for Change Password -->
      <div id="changePasswordModal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h4>Change Password</h4>
          </div>
          <form
            method="POST"
            action="{{ url_for('labourer_change_password') }}"
          >
            <input
              type="password"
              name="current_password"
              placeholder="Enter Current Password"
              required
            />
            <input
              type="password"
              name="new_password"
              placeholder="Enter New Password"
              required
            />
            <input
              type="password"
              name="confirm_password"
              placeholder="Confirm New Password"
              required
            />
            <div class="modal-footer">
              <button
                type="button"
                class="cancel-btn"
                id="cancelChangePassword"
              >
                Cancel
              </button>
              <button type="submit" class="delete-btn">Submit</button>
            </div>
          </form>
        </div>
      </div>

      <div id="locationModal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h5>Select a Region</h5>
          </div>
          <form method="POST" action="{{ url_for('labourer_save_location') }}">
            <div class="modal-body">
              <div class="form-group">
                <label for="location"></label>
                <select id="location" name="location" required>
                  <option value="" disabled selected>Select a region</option>
                  <option value="Northland">Northland</option>
                  <option value="Auckland">Auckland</option>
                  <option value="Waikato">Waikato</option>
                  <option value="Bay of Plenty">Bay of Plenty</option>
                  <option value="Gisborne">Gisborne</option>
                  <option value="Hawke's Bay">Hawke's Bay</option>
                  <option value="Taranaki">Taranaki</option>
                  <option value="Manawatū-Whanganui">Manawatū-Whanganui</option>
                  <option value="Wellington">Wellington</option>
                  <option value="Tasman">Tasman</option>
                  <option value="Nelson">Nelson</option>
                  <option value="Marlborough">Marlborough</option>
                  <option value="West Coast">West Coast</option>
                  <option value="Canterbury">Canterbury</option>
                  <option value="Otago">Otago</option>
                  <option value="Southland">Southland</option>
                </select>
              </div>
            </div>
            <div class="modal-footer">
              <!-- Only one close button is needed -->
              <button type="button" class="btn-close">Cancel</button>
              <button type="submit" class="btn-primary">Submit</button>
            </div>
          </form>
        </div>
      </div>

      <script>
        // Prevent the page from scrolling to the top when clicking the links
        document.querySelectorAll(".lower").forEach(function (link) {
          link.addEventListener("click", function (e) {
            e.preventDefault(); // Prevent the default link behavior (scroll to top)
            // Your modal logic here, e.g., showing the modal for change email
            if (link.id === "changeEmailBtn") {
              document.getElementById("changeEmailModal").style.display =
                "block";
            }
            if (link.id === "changePasswordBtn") {
              document.getElementById("changePasswordModal").style.display =
                "block";
            }
            if (link.id === "changeLocationBtn") {
              document.getElementById("changeLocationModal").style.display =
                "block";
            }
          });
        });

        // Get modal and buttons
        const locationModal = document.getElementById("locationModal");
        const changeLocationBtn = document.getElementById("changeLocationBtn");
        const closeLocationModal = document.querySelector(
          "#locationModal .btn-close"
        );

        // Show the modal when the change location button is clicked
        changeLocationBtn.onclick = () => {
          locationModal.style.display = "flex";
        };

        // Close the modal when the close button is clicked
        closeLocationModal.onclick = () => {
          locationModal.style.display = "none";
        };

        // Close the modal if clicked outside of the modal content
        window.onclick = (event) => {
          if (event.target === locationModal) {
            locationModal.style.display = "none";
          }
        };

        // Get modal and buttons
        const changeEmailModal = document.getElementById("changeEmailModal");
        const changePasswordModal = document.getElementById(
          "changePasswordModal"
        );
        const deleteAccountModal =
          document.getElementById("deleteAccountModal");

        const changeEmailBtn = document.getElementById("changeEmailBtn");
        const changePasswordBtn = document.getElementById("changePasswordBtn");
        const deleteAccountBtn = document.getElementById("deleteAccountBtn");

        const cancelChangeEmail = document.getElementById("cancelChangeEmail");
        const cancelChangePassword = document.getElementById(
          "cancelChangePassword"
        );
        const cancelDelete = document.getElementById("cancelDelete");

        // Show modals when corresponding buttons are clicked
        changeEmailBtn.onclick = () =>
          (changeEmailModal.style.display = "flex");
        changePasswordBtn.onclick = () =>
          (changePasswordModal.style.display = "flex");
        deleteAccountBtn.onclick = () =>
          (deleteAccountModal.style.display = "flex");

        // Close modals when cancel buttons are clicked
        cancelChangeEmail.onclick = () =>
          (changeEmailModal.style.display = "none");
        cancelChangePassword.onclick = () =>
          (changePasswordModal.style.display = "none");
        cancelDelete.onclick = () =>
          (deleteAccountModal.style.display = "none");

        // Close modals if clicked outside of them
        window.onclick = (event) => {
          if (event.target == changeEmailModal)
            changeEmailModal.style.display = "none";
          if (event.target == changePasswordModal)
            changePasswordModal.style.display = "none";
          if (event.target == deleteAccountModal)
            deleteAccountModal.style.display = "none";
        };
        // Preview the image after selection
        function previewImage() {
          const file = document.getElementById("id-image-upload").files[0];
          const previewContainer = document.getElementById(
            "image-preview-container"
          );
          const previewImage = document.getElementById("image-preview");

          // Check if file exists and is an image
          if (file && file.type.startsWith("image/")) {
            const reader = new FileReader();

            reader.onload = function (e) {
              previewImage.src = e.target.result; // Set the preview image source
              previewContainer.style.display = "block"; // Show the preview section
            };

            reader.readAsDataURL(file); // Read the image as a data URL
          }
        }

        // Submit the image using AJAX
        function submitIdImage() {
          var formData = new FormData(document.getElementById("id-image-form"));
          var uploadStatus = document.getElementById("upload-status");
          var previewContainer = document.getElementById(
            "image-preview-container"
          );

          // Show loading message
          uploadStatus.innerHTML = "<p>Uploading...</p>";

          // AJAX request to submit the form
          var xhr = new XMLHttpRequest();
          xhr.open(
            "POST",
            document.getElementById("id-image-form").action,
            true
          );

          // Handle the response after the file is uploaded
          xhr.onload = function () {
            if (xhr.status == 200) {
              uploadStatus.innerHTML = "<p>Upload successful!</p>";

              // Hide the preview and reset the file input
              previewContainer.style.display = "none";
              document.getElementById("id-image-upload").value = ""; // Reset file input
            } else {
              uploadStatus.innerHTML = "<p>Error uploading image.</p>";
            }
          };

          // Send the form data to the server
          xhr.send(formData);
        }

        // Preview the insurance image after selection
        function previewInsuranceImage() {
          const files = document.getElementById("insurance-image-upload").files;
          const previewContainer = document.getElementById(
            "insurance-image-preview-container"
          );
          const previewImages = document.getElementById("preview-images");

          previewImages.innerHTML = ""; // Clear previous previews

          // Check if any files are selected
          if (files.length > 0) {
            previewContainer.style.display = "block"; // Show the preview section
            for (let file of files) {
              const reader = new FileReader();

              reader.onload = function (e) {
                const fileType = file.type.split("/")[0];
                const fileElement = document.createElement("div");

                if (fileType === "image") {
                  const img = document.createElement("img");
                  img.src = e.target.result;
                  img.alt = "Insurance Preview";
                  img.style.maxWidth = "200px"; // Limit image size
                  fileElement.appendChild(img);
                } else if (
                  fileType === "application" &&
                  file.type === "application/pdf"
                ) {
                  const pdfLink = document.createElement("a");
                  pdfLink.href = e.target.result;
                  pdfLink.textContent = "Preview PDF";
                  pdfLink.target = "_blank";
                  fileElement.appendChild(pdfLink);
                }

                previewImages.appendChild(fileElement);
              };

              reader.readAsDataURL(file); // Read the image/document as a data URL
            }
          }
        }

        // Submit the insurance image using AJAX
        function submitInsuranceImage() {
          var formData = new FormData(
            document.getElementById("insurance-image-form")
          );
          var uploadStatus = document.getElementById("insurance-upload-status");
          var previewContainer = document.getElementById(
            "insurance-image-preview-container"
          );

          // Show loading message
          uploadStatus.innerHTML = "<p>Uploading...</p>";

          // AJAX request to submit the form
          var xhr = new XMLHttpRequest();
          xhr.open(
            "POST",
            document.getElementById("insurance-image-form").action,
            true
          );

          // Handle the response after the file is uploaded
          xhr.onload = function () {
            if (xhr.status == 200) {
              uploadStatus.innerHTML = "<p>Upload successful!</p>";

              // Hide the preview and reset the file input
              previewContainer.style.display = "none";
              document.getElementById("insurance-image-upload").value = ""; // Reset file input
            } else {
              uploadStatus.innerHTML = "<p>Error uploading image.</p>";
            }
          };

          // Send the form data to the server
          xhr.send(formData);
        }




      </script>
    </div>
    {% endblock %}
  </body>
</html>
