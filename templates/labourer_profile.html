<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Labourer Profile</title>
    <style>
      body {
        background-color: #ffffff;
        margin: 0;
        padding: 0;
        margin-bottom: 50px;
      }

      /* Profile container */
      .profile-container {
        max-width: 600px;
        margin: 20px auto;
        background-color: #ffffff;
        border-radius: 15px;
        padding: 20px;
      }

      /* Section container */
      .section-container {
        margin-bottom: 20px;
        padding: 20px;
        background-color: #f9f9f9;
        border: 1px solid #ddd;
        border-radius: 10px;
      }

      .section-container:last-child {
        margin-bottom: 50px;
      }

      /* Section headings */
      .section-container h2 {
        margin-top: 0;
        font-size: 20px;
        color: #333;
        border-bottom: 2px solid #ff7148;
        padding-bottom: 5px;
        margin-bottom: 15px;
      }

      /* Info items */
      .info-item {
        display: flex;
        justify-content: space-between;
        padding: 10px;
        background-color: #ffffff;
        border: 1px solid #ddd;
        border-radius: 5px;
        margin-bottom: 10px;
        font-size: 14px;
        display: -webkit-box;
        -webkit-box-orient: horizontal; /* Ensures content is laid out in a single row */
        overflow: hidden; /* Hides overflowed content */
        white-space: nowrap; /* Prevents text from wrapping */
        text-overflow: ellipsis; /* Adds ellipsis when text overflows */
      }

      .info-item strong {
        color: #333;
        font-weight: bold;
        margin-right: 5px;
      }

      .info-item span {
        color: #555;
      }

      /* Edit button */
      .edit-button {
        text-align: center;
        margin-top: 20px;
      }

      .edit-button a {
        color: #ffffff;
        background-color: #333;
        border-radius: 25px;
        padding: 10px 20px;
        text-decoration: none;
        font-size: 14px;
      }

      /* User location */
      .user-location {
        text-align: center;
        font-size: 18px;
        color: #3f3f3fc6;
      }

      .user-location .fa-map-marker-alt {
        font-size: 18px;
        vertical-align: middle;
        color: #3f3f3f82;
      }

      /* Profile image */
      .profile-pic-container {
        text-align: center;
        position: relative;
        margin-bottom: 40px;
      }

      .profile-pic {
        height: 155px;
        width: 155px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid #3f3f3f82;
      }

      .profile-pic-overlay {
        position: absolute;
        bottom: -10px;
        left: 50%;
        transform: translateX(-50%);
        padding: 5px;
        border-radius: 10px;
      }

      .edit-pic-button {
        background-color: #333;
        color: white;
        border: none;
        padding: 10px 20px;
        cursor: pointer;
        border-radius: 25px;
      }

      .social-links-info {
        background-color: #ffffff;
        padding: 15px;
        border-radius: 4px;
        margin-top: -15px;
        font-size: 14px;
        color: #333;
        line-height: 1.6;
      }

      .company-details-info {
        background-color: #ffffff;
        padding: 15px;
        border-radius: 4px;
        margin-top: -15px;
        font-size: 14px;
        color: #333;
        line-height: 1.6;
      }

      /* Job categories and locations section */
      .categories-locations-container {
        background-color: #f9f9f9;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: -10px;
        border: 1px solid #ddd;
      }

      .categories-locations-container h3 {
        font-size: 20px;
        color: #333;
        border-bottom: 2px solid #ff7148;
        padding-bottom: 5px;
      }

      .categories-locations-list {
        list-style: none;
        padding-left: 0;
        margin-top: 10px;
      }

      .categories-locations-list li {
        background-color: #ffffff;
        padding: 10px;
        margin: 5px 0;
        border-radius: 5px;
        font-size: 14px;
        border: 1px solid #ddd;
      }

      /* Image preview styling */
      #image-preview {
        margin-top: 10px;
        width: 150px;
        height: auto; /* Maintain aspect ratio */
        border-radius: 10px;
        display: block; /* Ensure it's a block element */
        align-items: center;
      }

      /* Styling for both buttons */
      .upload-id-button {
        background-color: #333; /* Dark gray background */
        color: white; /* White text */
        border: none; /* Remove default border */
        padding: 10px 20px; /* Add padding for click area */
        cursor: pointer; /* Pointer cursor for hover */
        border-radius: 5px; /* Rounded corners */
        margin-top: 10px; /* Space between elements */
        text-align: center; /* Center text */
        display: inline-block; /* Ensure inline-block layout */
      }

      /* Add hover effect for the button */
      .upload-id-button:hover {
        background-color: #555; /* Slightly lighter gray */
      }

      /* Additional container adjustments (optional) */
      #image-preview-container {
        text-align: center; /* Center content inside the container */
        margin-top: 20px;
        align-items: center;
      }

      #insurance-image-preview-container {
        text-align: center; /* Center content inside the container */
        margin-top: 20px;
        align-items: center;
      }

      #insurance-image-preview {
        margin-top: 10px;
        width: 150px;
        height: auto; /* Maintain aspect ratio */
        border-radius: 10px;
        display: block; /* Ensure it's a block element */
        align-items: center;
      }
    </style>
  </head>
  <body>
    {% extends 'base_labour.html' %} {% block title %}Labourer{% endblock %} {%
    block content %}
    <div class="profile-container">
      <!-- Profile Picture -->
      <div class="profile-pic-container">
        <img
          src="{{ url_for('static', filename='profile_pics/' + (current_user.profile_image.filename if current_user.profile_image else 'orange.jpg')) }}"
          alt="Profile Image"
          class="profile-pic"
        />
        <div class="profile-pic-overlay">
          <form
            id="profile-image-form"
            action="{{ url_for('labourer_image') }}"
            method="POST"
            enctype="multipart/form-data"
          >
            <label for="profile-image-upload" class="edit-pic-button"
              >Choose Image</label
            >
            <input
              type="file"
              id="profile-image-upload"
              name="profile_image"
              style="display: none"
              onchange="document.getElementById('profile-image-form').submit();"
            />
          </form>
        </div>
      </div>

      <!-- User Location -->
      <div class="user-location">
        <p><i class="fas fa-map-marker-alt"></i> {{ current_user.location }}</p>
      </div>
      <div class="social-links-info">
        <p>
          Step 1: Please complete your basic information before moving onto the
          next sections of profile setup. Be sure to choose a picture of
          yourself or company logo to display on your profile.
        </p>
      </div>

      <!-- User Information -->
      <div class="section-container">
        <h2>Basic Information*</h2>
        <div class="info-item">
          <strong>First Name:</strong>
          <span>{{ current_user.labourer_profile.first_name }}</span>
        </div>
        <div class="info-item">
          <strong>Last Name:</strong>
          <span>{{ current_user.labourer_profile.last_name }}</span>
        </div>
        <div class="info-item">
          {% if current_user.labourer_profile.date_of_birth %}
          <strong>Date of Birth:</strong>
          <span
            >{{ current_user.labourer_profile.date_of_birth.strftime('%d-%m-%Y')
            }}</span
          >
          {% else %}
          <strong>Date of Birth:</strong>
          <span></span>
          {% endif %}
        </div>
        <div class="info-item">
          <strong>Phone Number:</strong>
          <span>{{ current_user.labourer_profile.phone_number }}</span>
        </div>
        <div class="info-item">
          <strong>About Us:</strong>
          <span>{{ current_user.labourer_profile.user_blurb }}</span>
        </div>
        <div class="edit-button">
          <a href="{{ url_for('edit_labourer_profile') }}">Add/Edit</a>
        </div>
      </div>

      <div class="social-links-info">
        <p>
          Step 2: Select the Locations you operate in and the Job Categories you
          are interested in being shown.
        </p>
      </div>

      <!-- Categories and Locations Section -->
      <div class="categories-locations-container">
        <h3>Job Categories & Locations*</h3>
        <div>
          <strong>Selected Categories:</strong>
          <ul class="categories-locations-list">
            {% if current_user.labourer_profile.job_categories %} {% for
            category in current_user.labourer_profile.job_categories.split(', ')
            %}
            <li>{{ category }}</li>
            {% endfor %} {% else %}
            <li>Please select job categories.</li>
            {% endif %}
          </ul>
        </div>
        <div>
          <strong>Selected Locations:</strong>
          <ul class="categories-locations-list">
            {% if current_user.labourer_profile.job_locations %} {% for location
            in current_user.labourer_profile.job_locations.split(', ') %}
            <li>{{ location }}</li>
            {% endfor %} {% else %}
            <li>Please select job locations.</li>
            {% endif %}
          </ul>
          <div class="edit-button">
            <a href="{{ url_for('select_job_categories_and_locations') }}"
              >Update Categories & Locations</a
            >
          </div>
        </div>
      </div>
      <div class="company-details-info">
        <p>
          Step 3: Please complete your Business details. Only your trading name,
          NZBN and established date will be publicly visible on your profile.
        </p>
      </div>

      <!-- Company Information -->
      <div class="section-container">
        <h2>Company Details*</h2>
        <div class="info-item">
          <strong>Business Type:</strong>
          <span>{{ current_user.company_details.business_type }}</span>
        </div>
        <div class="info-item">
          <strong>Trading Name:</strong>
          <span>{{ current_user.company_details.trading_name }}</span>
        </div>
        <div class="info-item">
          <strong>Established:</strong>
          <span>{{ current_user.company_details.established }}</span>
        </div>
        <div class="info-item">
          <strong>NZBN:</strong>
          <span>{{ current_user.company_details.nzbn }}</span>
        </div>
        <div class="info-item">
          <strong>Director First Name:</strong>
          <span>{{ current_user.company_details.director_first_name }}</span>
        </div>
        <div class="info-item">
          <strong>Director Last Name:</strong>
          <span>{{ current_user.company_details.director_last_name }}</span>
        </div>
        <div class="info-item">
          <strong>Physical Address:</strong>
          <span>{{ current_user.company_details.physical_address }}</span>
        </div>
        <div class="info-item">
          <strong>Unit/Flat No:</strong>
          <span>{{ current_user.company_details.unit_no }}</span>
        </div>

        <div class="edit-button">
          <a href="{{ url_for('edit_tradesman_profile') }}">Add/Edit</a>
        </div>
      </div>
      <div class="social-links-info">
        <p>
          Step 4: We recommend including links to your business's social pages
          or other relevant online profiles to give users a better idea of who
          you are and build trust.
        </p>
      </div>

      <!-- Social Links -->
      <div class="section-container">
        <h2>Social Links</h2>
        <div class="info-item">
          <strong>Facebook:</strong>
          <span>{{ current_user.social_links.facebook }}</span>
        </div>
        <div class="info-item">
          <strong>Instagram:</strong>
          <span>{{ current_user.social_links.instagram }}</span>
        </div>
        <div class="info-item">
          <strong>Website:</strong>
          <span>{{ current_user.social_links.website }}</span>
        </div>
        <div class="info-item">
          <strong>Google:</strong>
          <span>{{ current_user.social_links.google }}</span>
        </div>

        <div class="edit-button">
          <a href="{{ url_for('edit_social_links') }}">Add/Edit</a>
        </div>
      </div>
      <div class="social-links-info">
        <p>
          Step 5: We require one form of identification to compare against your
          business details. This can be a picture of the front of your Drivers
          Licence or Passport photo page.
        </p>
      </div>

      <!-- Image Upload Section -->
      <div class="section-container">
        <h2>Upload Your ID Image*</h2>
        {% if user.labourer_profile.id_image %}
        <p>Your ID is saved</p>
        {% else %} {% endif %}
        <form
          id="id-image-form"
          action="{{ url_for('upload_id_image') }}"
          method="POST"
          enctype="multipart/form-data"
          class="upload-id-form"
        >
          <label for="id-image-upload" class="upload-id-button"
            >Upload ID Image</label
          >
          <input
            type="file"
            id="id-image-upload"
            name="id_image"
            style="display: none"
            accept="image/*"
            onchange="previewImage()"
          />
        </form>

        <!-- Preview Section -->
        <div id="image-preview-container" style="display: none">
          <img id="image-preview" src="" alt="Image Preview" />
          <button
            type="button"
            class="upload-id-button"
            onclick="submitIdImage()"
          >
            Confirm Image
          </button>
        </div>

        <!-- Upload Status -->
        <div id="upload-status"></div>
      </div>

      <div class="social-links-info">
        <p>
          Step 6: Upload a photo or file of your Business Liability Insurance
          document(s), ensuring that all key details are visible. This includes
          the policyholder's name, insurance provider, policy number, coverage
          details, and expiration date.
        </p>
      </div>
      <!-- Insurance Image Upload Section -->
      <div class="section-container">
        <h2>Upload Your Business Liability Insurance*</h2>
        {% if user.labourer_profile.insurance_image %}
        <p>Your Insurance document(s) are saved</p>
        {% else %} {% endif %}
        <form
          id="insurance-image-form"
          action="{{ url_for('upload_liability_insurance') }}"
          method="POST"
          enctype="multipart/form-data"
          class="upload-insurance-form"
        >
          <label for="insurance-image-upload" class="upload-id-button">
            Upload Insurance Document(s)
          </label>
          <input
            type="file"
            id="insurance-image-upload"
            name="liability_insurance"
            style="display: none"
            accept="image/*,.pdf"
            onchange="previewInsuranceImage()"
            multiple
          />
        </form>

        <!-- Preview Section -->
        <div id="insurance-image-preview-container" style="display: none">
          <div id="preview-images"></div>
          <button
            type="button"
            class="upload-id-button"
            onclick="submitInsuranceImage()"
          >
            Confirm Images/Documents
          </button>
        </div>

        <!-- Upload Status -->
        <div id="insurance-upload-status"></div>
      </div>

      <script>
        // Preview the image after selection
        function previewImage() {
          const file = document.getElementById("id-image-upload").files[0];
          const previewContainer = document.getElementById(
            "image-preview-container"
          );
          const previewImage = document.getElementById("image-preview");

          // Check if file exists and is an image
          if (file && file.type.startsWith("image/")) {
            const reader = new FileReader();

            reader.onload = function (e) {
              previewImage.src = e.target.result; // Set the preview image source
              previewContainer.style.display = "block"; // Show the preview section
            };

            reader.readAsDataURL(file); // Read the image as a data URL
          }
        }

        // Submit the image using AJAX
        function submitIdImage() {
          var formData = new FormData(document.getElementById("id-image-form"));
          var uploadStatus = document.getElementById("upload-status");
          var previewContainer = document.getElementById(
            "image-preview-container"
          );

          // Show loading message
          uploadStatus.innerHTML = "<p>Uploading...</p>";

          // AJAX request to submit the form
          var xhr = new XMLHttpRequest();
          xhr.open(
            "POST",
            document.getElementById("id-image-form").action,
            true
          );

          // Handle the response after the file is uploaded
          xhr.onload = function () {
            if (xhr.status == 200) {
              uploadStatus.innerHTML = "<p>Upload successful!</p>";

              // Hide the preview and reset the file input
              previewContainer.style.display = "none";
              document.getElementById("id-image-upload").value = ""; // Reset file input
            } else {
              uploadStatus.innerHTML = "<p>Error uploading image.</p>";
            }
          };

          // Send the form data to the server
          xhr.send(formData);
        }

        // Preview the insurance image after selection
        function previewInsuranceImage() {
          const files = document.getElementById("insurance-image-upload").files;
          const previewContainer = document.getElementById(
            "insurance-image-preview-container"
          );
          const previewImages = document.getElementById("preview-images");

          previewImages.innerHTML = ""; // Clear previous previews

          // Check if any files are selected
          if (files.length > 0) {
            previewContainer.style.display = "block"; // Show the preview section
            for (let file of files) {
              const reader = new FileReader();

              reader.onload = function (e) {
                const fileType = file.type.split("/")[0];
                const fileElement = document.createElement("div");

                if (fileType === "image") {
                  const img = document.createElement("img");
                  img.src = e.target.result;
                  img.alt = "Insurance Preview";
                  img.style.maxWidth = "200px"; // Limit image size
                  fileElement.appendChild(img);
                } else if (
                  fileType === "application" &&
                  file.type === "application/pdf"
                ) {
                  const pdfLink = document.createElement("a");
                  pdfLink.href = e.target.result;
                  pdfLink.textContent = "Preview PDF";
                  pdfLink.target = "_blank";
                  fileElement.appendChild(pdfLink);
                }

                previewImages.appendChild(fileElement);
              };

              reader.readAsDataURL(file); // Read the image/document as a data URL
            }
          }
        }

        // Submit the insurance image using AJAX
        function submitInsuranceImage() {
          var formData = new FormData(
            document.getElementById("insurance-image-form")
          );
          var uploadStatus = document.getElementById("insurance-upload-status");
          var previewContainer = document.getElementById(
            "insurance-image-preview-container"
          );

          // Show loading message
          uploadStatus.innerHTML = "<p>Uploading...</p>";

          // AJAX request to submit the form
          var xhr = new XMLHttpRequest();
          xhr.open(
            "POST",
            document.getElementById("insurance-image-form").action,
            true
          );

          // Handle the response after the file is uploaded
          xhr.onload = function () {
            if (xhr.status == 200) {
              uploadStatus.innerHTML = "<p>Upload successful!</p>";

              // Hide the preview and reset the file input
              previewContainer.style.display = "none";
              document.getElementById("insurance-image-upload").value = ""; // Reset file input
            } else {
              uploadStatus.innerHTML = "<p>Error uploading image.</p>";
            }
          };

          // Send the form data to the server
          xhr.send(formData);
        }
      </script>
    </div>
    {% endblock %}
  </body>
</html>
